import{u as N,r as h,a as w,j as e,H as M,b as C}from"./app-C3Bv2MaN.js";import{A as L}from"./AdminLayout-Cqoz6FrM.js";const f=[{key:"about.structure.roles.director",label:"Direktur"},{key:"about.structure.roles.mgr_batching",label:"Manager Batching Plant"},{key:"about.structure.roles.pm",label:"Project Manager"},{key:"about.structure.roles.admin",label:"Administrasi"},{key:"about.structure.roles.mgr_equipment",label:"Equipment Manager"},{key:"about.structure.roles.mgr_finance",label:"Finance Manager"},{key:"about.structure.roles.finance",label:"Keuangan"},{key:"about.structure.roles.executor",label:"Pelaksana"}],_=r=>{const n=new Map,l=[];r.forEach(s=>{n.set(s.id,{...s,children:[]})}),r.forEach(s=>{const a=n.get(s.id);a&&(s.parent_id&&n.has(s.parent_id)?n.get(s.parent_id).children.push(a):l.push(a))});const d=s=>{s.sort((a,c)=>a.order-c.order),s.forEach(a=>d(a.children))};return d(l),l},j=({node:r,level:n=0,onAddSubordinate:l,onEdit:d,onDelete:s,t:a})=>{const[c,o]=h.useState(!0),i=r.children&&r.children.length>0;return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:`relative flex items-center group transition-all duration-300 ${n>0?"ml-8 mt-4":"mb-4"}`,children:[n>0&&e.jsx("div",{className:"absolute -left-8 top-1/2 -translate-y-1/2 w-8 h-[2px] bg-gray-200"}),e.jsxs("div",{className:`
                    relative bg-white border border-gray-100 rounded-2xl p-4 shadow-sm hover:shadow-md transition-all duration-300 min-w-[320px]
                    flex items-center gap-4 z-10
                    ${n===0?"border-l-4 border-l-blue-600":""}
                `,children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 border border-blue-100 flex items-center justify-center text-blue-600 overflow-hidden shrink-0",children:e.jsx("span",{className:"font-bold text-lg",children:r.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-800 truncate",children:r.name}),e.jsx("p",{className:"text-sm text-blue-600 truncate",children:r.role.startsWith("about.structure.roles.")?a(r.role):r.role}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["Urutan: ",r.order]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>l(r.id),className:"p-1.5 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Tambah Bawahan",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsx("button",{onClick:()=>d(r),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 00-2 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>s(r.id),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Hapus",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),i&&e.jsx("button",{onClick:()=>o(!c),className:`
                                absolute -bottom-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full border border-gray-200 bg-white flex items-center justify-center text-gray-400 hover:text-blue-600 shadow-sm z-20 transition-transform duration-200
                                ${c?"rotate-180":"rotate-0"}
                            `,children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),i&&c&&e.jsx("div",{className:"relative border-l-2 border-gray-100 ml-[2.25rem] pl-4 pb-2",children:r.children.map(x=>e.jsx(j,{node:x,level:n+1,onAddSubordinate:l,onEdit:d,onDelete:s,t:a},x.id))})]})};function A({members:r}){const{t:n}=N(),[l,d]=h.useState(null),[s,a]=h.useState(!1),c=h.useMemo(()=>_(r),[r]),{data:o,setData:i,post:x,processing:b,errors:u,reset:g,clearErrors:p}=w({name:"",role:"",parent_id:"",order:0}),m=t=>{d(null),g(),p(),t&&i("parent_id",t),a(!0)},y=t=>{d(t),i({name:t.name,role:t.role,parent_id:t.parent_id||"",order:t.order}),p(),a(!0)},v=t=>{t.preventDefault(),l?x(route("admin.organization.update",l.id),{onSuccess:()=>{a(!1),g()}}):x(route("admin.organization.store"),{onSuccess:()=>{a(!1),g()}})},k=t=>{confirm("Apakah Anda yakin ingin menghapus anggota ini? Anggota di bawahnya akan dialihkan ke atasan anggota ini.")&&C.delete(route("admin.organization.destroy",t))};return e.jsxs(L,{children:[e.jsx(M,{title:"Kelola Struktur Organisasi"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 tracking-tight",children:"Struktur Organisasi"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Kelola hierarki dan bagan organisasi secara interaktif."})]}),e.jsxs("button",{onClick:()=>m(),className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl font-semibold text-sm transition-all shadow-sm flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Tambah Root Baru"]})]}),e.jsx("div",{className:"bg-white/50 rounded-3xl p-6 md:p-8 min-h-[500px] overflow-x-auto",children:e.jsx("div",{className:"min-w-[600px]",children:c.length>0?c.map(t=>e.jsx(j,{node:t,onAddSubordinate:m,onEdit:y,onDelete:k,t:n},t.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-gray-300",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsx("p",{className:"font-medium",children:"Belum ada struktur organisasi."}),e.jsx("button",{onClick:()=>m(),className:"text-blue-600 hover:underline mt-2 text-sm",children:"Buat anggota pertama"})]})})}),s&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/50 backdrop-blur-sm transition-all",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:l?"Edit Anggota":"Tambah Anggota Baru"}),e.jsx("button",{onClick:()=>a(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Nama Lengkap"}),e.jsx("input",{type:"text",value:o.name,onChange:t=>i("name",t.target.value),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all",placeholder:"Masukkan nama...",required:!0}),u.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Jabatan"}),e.jsxs("select",{value:o.role,onChange:t=>i("role",t.target.value),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all",required:!0,children:[e.jsx("option",{value:"",children:"-- Pilih Jabatan --"}),f.map(t=>e.jsx("option",{value:t.key,children:t.label},t.key)),!f.find(t=>t.key===o.role)&&o.role&&e.jsx("option",{value:o.role,children:o.role}),e.jsx("option",{value:"custom",children:"-- Lainnya (Ketik Manual) --"})]}),o.role==="custom"&&e.jsx("input",{type:"text",className:"w-full mt-2 px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all",placeholder:"Ketik jabatan manual...",onBlur:t=>i("role",t.target.value),autoFocus:!0}),u.role&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.role})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Atasan"}),e.jsxs("select",{value:o.parent_id,onChange:t=>i("parent_id",t.target.value),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all",children:[e.jsx("option",{value:"",children:"-- Root (Paling Atas) --"}),r.filter(t=>!l||t.id!==l.id).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.role.startsWith("about.structure.roles.")?n(t.role):t.role,")"]},t.id))]}),u.parent_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.parent_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Urutan"}),e.jsx("input",{type:"number",value:o.order,onChange:t=>i("order",parseInt(t.target.value)),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all"}),u.order&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.order})]})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>a(!1),className:"flex-1 px-4 py-2.5 border border-gray-200 rounded-xl font-bold text-gray-600 hover:bg-gray-50 transition-all text-sm",children:"Batal"}),e.jsx("button",{type:"submit",disabled:b,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-all text-sm disabled:opacity-50 shadow-lg shadow-blue-200",children:b?"Menyimpan...":"Simpan"})]})]})]})})]})}export{A as default};
