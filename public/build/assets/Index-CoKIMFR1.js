import{u as N,r as h,a as k,j as e,H as w,b as M}from"./app-BkaJp_q4.js";import{A as C}from"./AdminLayout-7shdCFPU.js";const L=r=>{const o=new Map,l=[];r.forEach(s=>{o.set(s.id,{...s,children:[]})}),r.forEach(s=>{const a=o.get(s.id);a&&(s.parent_id&&o.has(s.parent_id)?o.get(s.parent_id).children.push(a):l.push(a))});const c=s=>{s.sort((a,x)=>a.order-x.order),s.forEach(a=>c(a.children))};return c(l),l},f=({node:r,level:o=0,onAddSubordinate:l,onEdit:c,onDelete:s,t:a})=>{const[x,d]=h.useState(!0),n=r.children&&r.children.length>0;return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:`relative flex items-center group transition-all duration-300 ${o>0?"ml-8 mt-4":"mb-4"}`,children:[o>0&&e.jsx("div",{className:"absolute -left-8 top-1/2 -translate-y-1/2 w-8 h-[2px] bg-gray-200"}),e.jsxs("div",{className:`
                    relative bg-white border border-gray-100 rounded-2xl p-4 shadow-sm hover:shadow-md transition-all duration-300 min-w-[320px]
                    flex items-center gap-4 z-10
                    ${o===0?"border-l-4 border-l-blue-600":""}
                `,children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 border border-blue-100 flex items-center justify-center text-blue-600 overflow-hidden shrink-0",children:r.photo_path?e.jsx("img",{src:`/storage/${r.photo_path}`,alt:r.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"font-bold text-lg",children:r.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-800 truncate",children:r.name}),e.jsx("p",{className:"text-sm text-blue-600 truncate",children:r.role.startsWith("about.structure.roles.")?a(r.role):r.role}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["Urutan: ",r.order]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>l(r.id),className:"p-1.5 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Tambah Bawahan",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsx("button",{onClick:()=>c(r),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 00-2 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>s(r.id),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Hapus",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n&&e.jsx("button",{onClick:()=>d(!x),className:`
                                absolute -bottom-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full border border-gray-200 bg-white flex items-center justify-center text-gray-400 hover:text-blue-600 shadow-sm z-20 transition-transform duration-200
                                ${x?"rotate-180":"rotate-0"}
                            `,children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),n&&x&&e.jsx("div",{className:"relative border-l-2 border-gray-100 ml-[2.25rem] pl-4 pb-2",children:r.children.map(u=>e.jsx(f,{node:u,level:o+1,onAddSubordinate:l,onEdit:c,onDelete:s,t:a},u.id))})]})};function E({members:r}){const{t:o}=N(),[l,c]=h.useState(null),[s,a]=h.useState(!1),x=h.useMemo(()=>L(r),[r]),{data:d,setData:n,post:u,processing:p,errors:i,reset:m,clearErrors:b}=k({name:"",role:"",parent_id:"",photo:null,order:0}),g=t=>{c(null),m(),b(),t&&n("parent_id",t),a(!0)},j=t=>{c(t),n({name:t.name,role:t.role,parent_id:t.parent_id||"",photo:null,order:t.order}),b(),a(!0)},v=t=>{t.preventDefault(),l?u(route("admin.organization.update",l.id),{onSuccess:()=>{a(!1),m()}}):u(route("admin.organization.store"),{onSuccess:()=>{a(!1),m()}})},y=t=>{confirm("Apakah Anda yakin ingin menghapus anggota ini? Anggota di bawahnya akan dialihkan ke atasan anggota ini.")&&M.delete(route("admin.organization.destroy",t))};return e.jsxs(C,{children:[e.jsx(w,{title:"Kelola Struktur Organisasi"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 tracking-tight",children:"Struktur Organisasi"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Kelola hierarki dan bagan organisasi secara interaktif."})]}),e.jsxs("button",{onClick:()=>g(),className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl font-semibold text-sm transition-all shadow-sm flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Tambah Root Baru"]})]}),e.jsx("div",{className:"bg-white/50 rounded-3xl p-6 md:p-8 min-h-[500px] overflow-x-auto",children:e.jsx("div",{className:"min-w-[600px]",children:x.length>0?x.map(t=>e.jsx(f,{node:t,onAddSubordinate:g,onEdit:j,onDelete:y,t:o},t.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-gray-300",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsx("p",{className:"font-medium",children:"Belum ada struktur organisasi."}),e.jsx("button",{onClick:()=>g(),className:"text-blue-600 hover:underline mt-2 text-sm",children:"Buat anggota pertama"})]})})}),s&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/50 backdrop-blur-sm transition-all",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:l?"Edit Anggota":"Tambah Anggota Baru"}),e.jsx("button",{onClick:()=>a(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Nama Lengkap"}),e.jsx("input",{type:"text",value:d.name,onChange:t=>n("name",t.target.value),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all",placeholder:"Masukkan nama...",required:!0}),i.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Jabatan"}),e.jsx("input",{type:"text",value:d.role,onChange:t=>n("role",t.target.value),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all",placeholder:"Masukkan jabatan...",required:!0}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1 italic",children:"*Mendukung translation keys (mis: about.structure.roles.director)"}),i.role&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.role})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Atasan"}),e.jsxs("select",{value:d.parent_id,onChange:t=>n("parent_id",t.target.value),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all",children:[e.jsx("option",{value:"",children:"-- Root (Paling Atas) --"}),r.filter(t=>!l||t.id!==l.id).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.role,")"]},t.id))]}),i.parent_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.parent_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Urutan"}),e.jsx("input",{type:"number",value:d.order,onChange:t=>n("order",parseInt(t.target.value)),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all"}),i.order&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.order})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Foto (Opsional)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[(l?.photo_path||d.photo)&&e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 overflow-hidden shrink-0 border border-gray-200",children:d.photo?e.jsx("img",{src:URL.createObjectURL(d.photo),className:"w-full h-full object-cover"}):e.jsx("img",{src:`/storage/${l?.photo_path}`,className:"w-full h-full object-cover"})}),e.jsx("input",{type:"file",onChange:t=>n("photo",t.target.files?t.target.files[0]:null),className:"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-xl file:border-0 file:text-sm file:font-bold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition-all cursor-pointer",accept:"image/*"})]}),i.photo&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.photo})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>a(!1),className:"flex-1 px-4 py-2.5 border border-gray-200 rounded-xl font-bold text-gray-600 hover:bg-gray-50 transition-all text-sm",children:"Batal"}),e.jsx("button",{type:"submit",disabled:p,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-all text-sm disabled:opacity-50 shadow-lg shadow-blue-200",children:p?"Menyimpan...":"Simpan"})]})]})]})})]})}export{E as default};
